# Hungarian language pack — v2.95 revision
# Hungarian is SYLLABLE-TIMED with fixed initial stress, phonemic vowel length,
# and a rich palatal consonant inventory. Prosody is relatively flat with
# gentle final fall — quite different from English stress-timing.

settings:
  legacyPitchMode: espeak_style

  # === PITCH MODEL ===
  # Hungarian intonation: relatively flat phrase with gentle terminal fall.
  # Stress is word-initial but realized mainly as F0 prominence, not duration.
  # Fujisaki with low amplitudes captures this better than eSpeak's
  # English-centric stepped contours.
  fujisakiPhraseAmp: 0.16
  fujisakiPrimaryAccentAmp: 0.12
  fujisakiSecondaryAccentAmp: 0.0
  fujisakiAccentMode: "first_only"
  fujisakiDeclinationScale: 18.0
  fujisakiDeclinationMax: 1.15
  fujisakiDeclinationPostFloor: 0.08

  # === STRESS ===
  # Hungarian stress is word-initial and very subtle — mainly pitch, not length.
  # A tiny durational cue is natural but must not distort short/long contrasts.
  primaryStressDiv: 1.05
  secondaryStressDiv: 1.00

  # === LENGTH CONTRAST ===
  # Hungarian has phonemic vowel length (a/á, e/é, i/í, etc.) — this MUST be
  # perceptually clear. The short/long distinction is the #1 prosodic feature.
  lengthenedScale: 1.80
  lengthenedScaleHu: 1.80
  lengthenedVowelFinalCodaScale: 0.92
  applyLengthenedScaleToVowelsOnly: false

  lengthContrast:
    enabled: true
    shortVowelCeiling: 70
    longVowelFloor: 115
    geminateClosureScale: 1.6
    geminateReleaseScale: 0.90
    preGeminateVowelScale: 0.85

  # === COARTICULATION ===
  # ENABLED at moderate strength. Real Hungarian speech has coarticulation —
  # turning it off entirely makes speech sound like isolated phoneme splicing.
  #
  # The ɡ/ɟ confusion near front vowels is fixed by:
  #   - Disabling velar pinch (which pulls velar F2 up toward palatals)
  #   - Keeping F2 coarticulation moderate (0.7 instead of 1.0)
  #   - Using MITalk-K locus weighting to anchor consonants
  #
  # This lets labials, alveolars, and nasals coarticulate naturally while
  # keeping velars safely separated from palatals.
  coarticulationEnabled: true
  coarticulationStrength: 0.20
  coarticulationTransitionExtent: 0.30
  coarticulationFadeIntoConsonants: true
  coarticulationWordInitialFadeScale: 0.8

  coarticulationGraduated: true
  coarticulationAdjacencyMaxConsonants: 1

  coarticulationLabialF2Locus: 800
  coarticulationAlveolarF2Locus: 1800
  coarticulationVelarF2Locus: 2000

  # Velar pinch OFF — this is what was pulling ɡ toward ɟ near front vowels.
  coarticulationVelarPinchEnabled: false

  coarticulationF1Scale: 0.4
  coarticulationF2Scale: 0.7
  coarticulationF3Scale: 0.3

  coarticulationMitalkK: 0.50

  coarticulationAlveolarBackVowelEnabled: false
  coarticulationLabializedFricativeFrontingEnabled: false

  # === BOUNDARY SMOOTHING ===
  # Crisp ≠ discontinuous. Even fast Hungarian speech has ~5-8ms of formant
  # transition at segment boundaries. Without smoothing, every phoneme boundary
  # is a hard splice — a major source of roboticness.
  # Using shorter values than English to preserve Hungarian consonant clarity.
  boundarySmoothing:
    enabled: true
    vowelToStopFadeMs: 8
    stopToVowelFadeMs: 6
    vowelToFricFadeMs: 4

  # === STOP CLOSURE ===
  # Hungarian stops need clear closures but "always" mode with 32ms gaps
  # inserts ~96ms of dead air in a word like "Budapest." Vowel-and-cluster
  # mode gives closures where they matter without chopping every syllable.
  stopClosureMode: vowel-and-cluster
  stopClosureAfterNasalsEnabled: true
  stopClosureVowelGapMs: 26.0
  stopClosureVowelFadeMs: 6.0
  stopClosureClusterGapMs: 18.0
  stopClosureClusterFadeMs: 4.0

  # === SEGMENT BOUNDARIES ===
  # 16ms gap between every segment was causing staccato rhythm.
  # Hungarian is syllable-timed — syllables should flow, not be chopped.
  # A small gap (4ms) is enough to prevent cross-segment artifacts.
  segmentBoundaryGapMs: 4
  segmentBoundaryFadeMs: 2
  segmentBoundarySkipVowelToVowel: true
  segmentBoundarySkipVowelToLiquid: true

  # === TRAJECTORY LIMITING ===
  # Prevents jarring formant jumps across segment boundaries.
  # Slightly relaxed from previous (cf2: 22→24) to let consonants stay distinct.
  boundarySmoothingEnabled: true
  trajectoryLimit:
    enabled: true
    applyTo: [cf1, cf2, cf3, pf2, pf3]
    maxHzPerMs:
      cf1: 16
      cf2: 24
      cf3: 28
      pf2: 24
      pf3: 28
    windowMs: 20
    liquidRateScale: 1.5
    applyAcrossWordBoundary: false

  # === PHRASE-FINAL LENGTHENING ===
  # Hungarian has moderate final lengthening — less than English.
  # Nucleus-only mode: stretch the vowel, not the coda consonants.
  phraseFinalLengtheningEnabled: true
  phraseFinalLengtheningNucleusOnlyMode: true
  phraseFinalLengtheningFinalSyllableScale: 1.18
  phraseFinalLengtheningPenultimateSyllableScale: 1.05
  phraseFinalLengtheningStatementScale: 1.0
  phraseFinalLengtheningQuestionScale: 0.90

  # === RATE COMPENSATION ===
  # Protect segments from being crushed at high speech rates.
  # Critical for Hungarian: word-final vowels (like -ük, -ek, -öt) must
  # stay audible or morphology disappears. Trill needs room too.
  rateCompensation:
    enabled: true
    minimumDurations:
      vowelMs: 28
      fricativeMs: 18
      stopMs: 4
      nasalMs: 18
      liquidMs: 15
      affricateMs: 14
      semivowelMs: 10
      tapMs: 4
      trillMs: 16
      voicedConsonantMs: 10
    wordFinalBonusMs: 8
    floorSpeedScale: 0.0
    clusterProportionGuard: true
    clusterMaxRatioShift: 0.4
    schwaReduction:
      enabled: false

  # === MICROPROSODY ===
  # Subtle F0 effects tuned for Hungarian's flat prosodic profile.
  # Voiceless onset raise OFF — it creates English-like bounce.
  # Pre-voiceless shortening OFF — Hungarian vowel length is phonemic,
  # duration must NEVER be shortened by allophonic rules.
  microprosodyEnabled: true
  microprosodyVoicelessF0RaiseEnabled: false
  microprosodyVoicedF0LowerEnabled: true
  microprosodyVoicedF0LowerHz: 4.0
  microprosodyVoicedFricativeLowerScale: 0.5
  microprosodyMinVowelMs: 25.0

  # Following-consonant F0: very subtle for Hungarian's flat contour.
  microprosodyFollowingF0Enabled: true
  microprosodyFollowingVoicelessRaiseHz: 3.0
  microprosodyFollowingVoicedLowerHz: 2.0

  # Intrinsic vowel F0: universal biomechanics, keep subtle.
  microprosodyIntrinsicF0Enabled: true
  microprosodyIntrinsicF0HighThreshold: 400.0
  microprosodyIntrinsicF0LowThreshold: 600.0
  microprosodyIntrinsicF0HighRaiseHz: 3.0
  microprosodyIntrinsicF0LowDropHz: 2.0

  # Pre-voiceless shortening: OFF for Hungarian. Vowel length is phonemic.
  microprosodyPreVoicelessShortenEnabled: false

  # Cap: Hungarian prosody is flatter than English.
  microprosodyMaxTotalDeltaHz: 8.0

  # === PROMINENCE ===
  # Hungarian prominence is very different from English:
  #   - Stress is ALWAYS word-initial, realized through F0 + intensity
  #     (Fónagy, 1958), NOT through duration
  #   - Vowel length is PHONEMIC (distinguishes words), NOT prosodic
  #   - There is NO secondary stress (White & Mády, 2008)
  #   - Unstressed vowels are NOT reduced
  #
  # So: amplitude is our main realization channel. Duration stays
  # hands-off — the length contrast system (lengthenedScale: 1.80,
  # shortVowelCeiling/longVowelFloor) is sacred.
  #
  # Long vowels get a subtle amplitude lift via longVowelWeight. This
  # matches the perceptual effect where non-native speakers "hear"
  # long vowels as stressed — they aren't, but they do carry natural
  # acoustic weight from their duration alone. A tiny amplitude nudge
  # makes this sound more alive without inventing fake stress.
  prominence:
    enabled: true

    # Sources
    primaryStressWeight: 1.0
    secondaryStressWeight: 0.15      # gentle compound boundary — low enough that stray ˌ on case suffixes is inaudible
    longVowelWeight: 0.35            # subtle weight for unstressed long vowels
    longVowelMode: "unstressed-only" # only boosts long vowels NOT already stressed
    wordInitialBoost: 0.15           # reinforces natural word-initial stress
    wordFinalReduction: 0.0          # Hungarian doesn't trail off

    # Duration: HANDS OFF. Hungarian vowel duration is phonemic.
    # The length contrast system handles this. Prominence must not interfere.
    durationProminentFloorMs: 0      # disabled
    durationReducedCeiling: 1.0      # no reduction — Hungarian doesn't reduce unstressed vowels

    # Amplitude: THIS is how Hungarian stress lives.
    # Stressed syllable gets a real intensity boost. Unstressed gets a
    # very mild reduction — just enough for contour, not enough to
    # create English-style reduction (which would sound wrong).
    amplitudeBoostDb: 1.8
    amplitudeReductionDb: 0.0        # Hungarian does NOT reduce unstressed vowels

    # Pitch: disabled for now — hu.yaml uses espeak_style pitch model.
    # The prominence-driven Fujisaki accent path only fires under
    # fujisaki_style. When Hungarian eventually moves to Fujisaki,
    # flip this to true and the long-vowel pitch peaks come free.
    pitchFromProminence: false

  # === TRILL (rolled R) ===
  trillModulationMs: 28.0
  trillModulationFadeMs: 0.0

  # === HUNGARIAN SHORT "A" ===
  # Hungarian short "a" is /ɒ/ (open back rounded), very distinct from
  # long "á" /aː/ (open central unrounded). The ᴒ phoneme captures this.
  huShortAVowelEnabled: true
  huShortAVowelKey: "ᴒ"
  huShortAVowelScale: 0.82

  # === DIPHTHONGS & LIQUIDS ===
  # Hungarian has no true diphthongs (unlike English). Keep these off.
  autoTieDiphthongs: false

  # Liquid dynamics off — Hungarian /l/ and /r/ are fairly static.
  # The trill modulation above handles /r/ character.
  liquidDynamicsEnabled: false
  # === ALLOPHONE RULES ===
  # Hungarian intervocalic /h/ is realized as voiced [ɦ] in natural speech.
  # This eliminates the voiced→voiceless→voiced energy dip that causes
  # transition pops on words like "tehát", "ahogy", "ehez".
  # The [ɦ] phoneme has _copyAdjacent: true, so it inherits surrounding
  # vowel formant colors — just like /h/ does, but with voicing maintained.
  allophoneRules:
    enabled: true
    rules:
      - name: voiced_intervocalic_h
        phonemes: [h]
        position: intervocalic
        action: replace
        replaceTo: "ɦ"
  # === NASALIZATION ===
  # Hungarian doesn't have phonemic nasalization.
  nasalizationAnticipatoryEnabled: false

  # === GLOTTAL REINFORCEMENT ===
  # Not a feature of Hungarian.
  positionalAllophonesGlottalReinforcementEnabled: false

  # === SINGLE WORD TUNING ===
  singleWordTuningEnabled: true
  singleWordFinalHoldMs: 45
  singleWordFinalFadeMs: 15
  singleWordClauseTypeOverride: "."
  singleWordClauseTypeOverrideCommaOnly: true

  spellingDiphthongMode: monophthong
  legacyPitchInflectionScale: 0.56
normalization:
  preReplacements:
    # === LONG VOWEL MAPPINGS ===
    # eSpeak outputs generic IPA long vowels (aː, eː, etc.).
    # We remap to Hungarian-specific phoneme keys that have correct
    # formant targets for the Hungarian vowel space.
    - from: "aː"
      to: "áː"
    - from: "eː"
      to: "éː"
    - from: "iː"
      to: "íː"
    - from: "oː"
      to: "óː"
    - from: "øː"
      to: "őː"
    - from: "uː"
      to: "úː"
    - from: "yː"
      to: "űː"

    # === HUNGARIAN SHORT "A" ===
    # Hungarian short "a" is /ɒ/ (open back rounded), not /ɑ/.
    # eSpeak may output either — map both to our tuned ᴒ.
    - from: "ɑ"
      to: "ᴒ"
    - from: "ɒ"
      to: "ᴒ"

    # === PALATAL NASAL ===
    # eSpeak may output n͡ʲ or nʲ for Hungarian "ny" — normalize to ɲ.
    - from: "n͡ʲ"
      to: "ɲ"
    - from: "nʲ"
      to: "ɲ"

    # Strip stray palatalization markers that eSpeak may leave behind
    - from: "ʲ"
      to: ""

    # === GY (ɟ) STRESS HANDLING ===
    # Move stress marker after word-initial gy/dzs so the stop closure
    # gets proper timing without the stress marker sitting on it.
    - from: "ˈɟ"
      to: "ɟˈ"
      when:
        atWordStart: true
    - from: "ˈd͡ʑ"
      to: "d͡ʑˈ"
      when:
        atWordStart: true

    # === COMPOUND BOUNDARY STRESS ===
    # Removed blanket ˌ strip — eSpeak's ˌ on compound second-elements
    # is correct. The prominence pass handles it gently via
    # secondaryStressWeight: 0.3 (mild amplitude boost at compound boundary).
    # - from: "ˌ"
    #   to: ""

  replacements:
    # === CLUSTER CLARITY ===
    # Insert micro-schwa in difficult clusters for audibility.
    # "megszülettek" has ɡs cluster that merges without help.
    - from: "ɡs"
      to: "ɡᵊs"

    # === COMPOUND WORD HELP ===
    # Final "jel" in compounds — add secondary stress for audibility.
    - from: "jɛl"
      to: "jˌɛl"
      when:
        atWordEnd: true

intonation:
  ".":
    # Hungarian declaratives: relatively flat, gentle terminal fall.
    # Less dramatic than English — steady pitch with subtle decline.
    preHeadStart: 55
    preHeadEnd: 50
    headStart: 52
    headEnd: 45
    nucleus0Start: 50
    nucleus0End: 15
    nucleusStart: 48
    nucleusEnd: 20
    tailStart: 25
    tailEnd: 8

  "?":
    # Hungarian yes/no questions: rise at end.
    # Wh-questions typically fall (handled by stress pattern).
    preHeadStart: 45
    preHeadEnd: 50
    nucleus0Start: 55
    nucleus0End: 85
    nucleusStart: 50
    nucleusEnd: 80
    tailStart: 75
    tailEnd: 90

  ",":
    # Continuation: slight rise to signal more coming.
    preHeadStart: 50
    preHeadEnd: 48
    nucleus0Start: 50
    nucleus0End: 55
    nucleusStart: 48
    nucleusEnd: 52
    tailStart: 50
    tailEnd: 55

  "!":
    # Exclamation: stronger initial accent, sharper fall.
    preHeadStart: 60
    preHeadEnd: 55
    headStart: 62
    headEnd: 48
    nucleus0Start: 55
    nucleus0End: 10
    nucleusStart: 55
    nucleusEnd: 15
    tailStart: 20
    tailEnd: 5