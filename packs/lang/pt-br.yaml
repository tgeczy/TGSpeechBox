# Portuguese (Brazil) (pt-br)
# Inherits from: default.yaml -> pt.yaml

settings:
  # Helps make consonant+R clusters (bra, tra, etc.) more distinct.
  stopClosureMode: "vowel-and-cluster"
  stopClosureClusterGapsEnabled: true
  stopClosureClusterGapMs: 28.0
  stopClosureClusterFadeMs: 5.0
  stopClosureWordBoundaryClusterGapMs: 12.0
  stopClosureWordBoundaryClusterFadeMs: 3.0
  lengthenedScale: 2.44

normalization:
  classes:
    # Broad list of consonants for cluster rules.
    # (Used to detect consonant+ɾ+vowel sequences like "bra", "tra", "pra"...)
    PT_CONSONANTS:
      - p
      - b
      - t
      - d
      - k
      - ɡ
      - f
      - v
      - s
      - z
      - ʃ
      - ʒ
      - m
      - n
      - ɲ
      - l
      - ʎ
      - r
      - ɾ
      - j
      - w
      - t͡s
      - d͡z
      - t͡ʃ
      - d͡ʒ

  replacements:
    # eSpeak pt-br emits "y" for the raised final "e" (roughly like [i~ɪ]).
    # But after nasal "ã" it behaves like a glide (mãe, pães).
    - from: "ãy"
      to: "ãj"
    - from: "y"
      to: "i"
    - from: "iˈãᴜ"
      to:   "iːˈãᴜ"
    - from: "iˌãᴜ"
      to:   "iːˌãᴜ"

    # eSpeak pt-br often uses "æ" for word-final unstressed "a" (casa, feira).
    # Map it to a central a-like vowel so it doesn't sound like English "cat".
    - from: "æ"
      to: "a"

    # Brazilian Portuguese "ã" tends to be a bit darker/rounder than pt-pt.
    # Use a dedicated BR nasal-a vowel so it doesn't inherit the European sound.
    - from: "ã"
      to: "Ã"

    # In Brazilian Portuguese, "r" in clusters and word-final is closer to a tap.
    - from: "r"
      to: "ɾ"

    # Insert a non-syllabic schwa-like separator before the tap in consonant+R clusters
    # (bra, tra, cra, fra, ...). This improves intelligibility without creating a full extra syllable.
    - from: "ɾˈ"
      to: "ᵊɾˈ"
      when:
        afterClass: PT_CONSONANTS
        beforeClass: PT_VOWELS
    - from: "ɾˌ"
      to: "ᵊɾˌ"
      when:
        afterClass: PT_CONSONANTS
        beforeClass: PT_VOWELS
    - from: "ɾ"
      to: "ᵊɾ"
      when:
        afterClass: PT_CONSONANTS
        beforeClass: PT_VOWELS
