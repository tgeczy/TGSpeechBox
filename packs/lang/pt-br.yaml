# Portuguese (Brazil) (pt-br)
# Inherits from: default.yaml -> pt.yaml

settings:
  # Helps make consonant+R clusters (bra, tra, etc.) more distinct.
  stopClosureMode: "vowel-and-cluster"
  stopClosureClusterGapsEnabled: true
  stopClosureClusterGapMs: 28.0
  stopClosureClusterFadeMs: 5.0
  stopClosureWordBoundaryClusterGapMs: 12.0
  stopClosureWordBoundaryClusterFadeMs: 3.0
  lengthenedScale: 2.44

  # Single-word utterance smoothing (key echo / word-by-word navigation)
  singleWordTuningEnabled: true
  singleWordFinalHoldMs: 45
  singleWordFinalFadeMs: 18
  singleWordClauseTypeOverride: "."
  singleWordClauseTypeOverrideCommaOnly: true

normalization:
  classes:
    # Broad list of consonants for cluster rules.
    # (Used to detect consonant+ɾ+vowel sequences like "bra", "tra", "pra"...)
    PT_CONSONANTS:
      - p
      - b
      - t
      - d
      - k
      - ɡ
      - f
      - v
      - s
      - z
      - ʃ
      - ʒ
      - m
      - n
      - ɲ
      - l
      - ʎ
      - r
      - ɾ
      - j
      - w
      - t͡s
      - d͡z
      - t͡ʃ
      - d͡ʒ

  replacements:
    # --- BR vowel/consonant fixes (moved from pt.yaml in v2.97) ---
    # These are Brazilian-specific and were incorrectly in the shared pack.

    # Brazilian R: eSpeak pt-br emits "x" for coda R (barra, porta).
    # Map to /h/ for the typical Rio/São Paulo realization.
    - from: "x"
      to: "h"

    # Brazilian /ʊ/ in words like "topo" — map to plain /u/.
    - from: "ʊ"
      to: "u"

    # Brazilian open-o shift: ɔ → ɒ (rounder, more back).
    - from: "ɔ"
      to: "ɒ"

    # Brazilian mid-o: o → ɔ (more open than European).
    - from: "o"
      to: "ɔ"

    # eSpeak pt-br emits "y" for the raised final "e" (roughly like [i~ɪ]).
    # But after nasal "ã" it behaves like a glide (mãe, pães).
    - from: "ãy"
      to: "ãj"
    - from: "y"
      to: "i"
    - from: "iˈãᴜ"
      to:   "iːˈãᴜ"
    - from: "iˌãᴜ"
      to:   "iːˌãᴜ"

    # eSpeak pt-br often uses "æ" for word-final unstressed "a" (casa, feira).
    # Map it to a central a-like vowel so it doesn't sound like English "cat".
    - from: "æ"
      to: "a"

    # Brazilian Portuguese "ã" tends to be a bit darker/rounder than pt-pt.
    # Use a dedicated BR nasal-a vowel so it doesn't inherit the European sound.
    - from: "ã"
      to: "Ã"

    # In Brazilian Portuguese, "r" in clusters and word-final is closer to a tap.
    - from: "r"
      to: "ɾ"

    # Brazilian Portuguese palatal nasal (nh) benefits from a palatal offglide.
    # This makes words like "ninho", "senhor" sound more natural.
    - from: "ɲ"
      to: "ɲj"

    # Insert a non-syllabic schwa-like separator before the tap in consonant+R clusters
    # (bra, tra, cra, fra, ...). This improves intelligibility without creating a full extra syllable.
    - from: "ɾˈ"
      to: "ᵊɾˈ"
      when:
        afterClass: PT_CONSONANTS
        beforeClass: PT_VOWELS
    - from: "ɾˌ"
      to: "ᵊɾˌ"
      when:
        afterClass: PT_CONSONANTS
        beforeClass: PT_VOWELS
    - from: "ɾ"
      to: "ᵊɾ"
      when:
        afterClass: PT_CONSONANTS
        beforeClass: PT_VOWELS
