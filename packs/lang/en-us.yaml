# packs/lang/en-us.yaml
# English (US) overrides layered on top of default.yaml + en.yaml

settings:
  # Keep stop closures for clarity, but avoid the overly-clicky "always" mode
  # (helps clusters like "adjust" and "change" feel less springy).
  stopClosureMode: vowel-and-cluster
  # If a word ends in a consonant and the next word starts with a stop,
  # that word-initial stop can get swallowed (e.g. "... applications toolbar").
  # Turn on cluster gaps, and make *word-boundary* cluster gaps slightly longer
  # than in-word clusters for clarity, without going full "always".
  stopClosureClusterGapsEnabled: true
  stopClosureAfterNasalsEnabled: true

  # Allow gaps after nasals too, so phrases like "column two" don't swallow the /t/.
  stopClosureVowelGapMs: 18
  stopClosureVowelFadeMs: 4
  stopClosureClusterGapMs: 16
  stopClosureClusterFadeMs: 4
  stopClosureWordBoundaryClusterGapMs: 24
  stopClosureWordBoundaryClusterFadeMs: 4

  # US: smoother overall, less breath noise on stop releases.
  postStopAspirationEnabled: true

  # US tends to shorten length-marked vowels in word-final closed syllables
  # (e.g. "tools", "smooth").
  lengthenedVowelFinalCodaScale: 0.90

  # Allow length marks to apply to consonants too (for word-final R lengthening)
  applyLengthenedScaleToVowelsOnly: false
  # Make length marks more effective (default is only 1.05)
  lengthenedScale: 1.05

  # Use the US/CA GOOSE vowel variant.
  englishLongUShortenEnabled: true
  englishLongUWordFinalScale: 0.95
  englishLongUKey: "ᵿ"

  spellingDiphthongMode: monophthong

  # Keep defaults conservative: avoid heavy cross-phoneme shaping here.
  coarticulationEnabled: false
  boundarySmoothingEnabled: false
  trajectoryLimitEnabled: false
  microprosodyEnabled: false
  rateReductionEnabled: false
  segmentBoundarySkipVowelToLiquid: false
  coarticulationFadeIntoConsonants: false
  coarticulationVelarPinchEnabled: false
  coarticulationGraduated: false
  coarticulationAdjacencyMaxConsonants: 2
  phraseFinalLengtheningEnabled: false
  phraseFinalLengtheningNucleusOnlyMode: false
  microprosodyVoicelessF0RaiseEnabled: false
  microprosodyVoicedF0LowerEnabled: false
  nasalizationAnticipatoryEnabled: false
  liquidDynamics:
    enabled: true
    # American-style rhotic quality - creates movement in the R
    rhoticF3Dip:
      enabled: true
      f3Minimum: 1300
      dipDurationPct: 0.55
  lengthContrast:
    enabled: false
  positionalAllophones:
    enabled: false
    glottalReinforcement:
      enabled: false
  boundarySmoothing:
    enabled: false
  trajectoryLimit:
    enabled: false
    applyAcrossWordBoundary: false
normalization:
  preReplacements:
    # Protect PRICE/MOUTH diphthongs from broad TRAP rules (e.g. five/nine/out).
    # With tie-insensitive rule matching in the frontend, these match both 'aɪ' and 'a͡ɪ'.
    - from: "a͡ɪ"
      to:   "ɑ͡ɪ"
    - from: "a͡ʊ"
      to:   "ɑ͡ʊ"

  classes:
    # Vowels (including schwa/r-colored and extra internal keys used by English packs).
    VOWELS: ["a", "e", "i", "o", "u", "ɐ", "ə", "ɜ", "ɝ", "ɑ", "ɒ", "ɔ", "ɛ", "æ", "ʊ", "ɪ", "ᵾ", "ᵿ", "ᴏ", "ᴐ", "ᴒ", "ã", "ẽ", "ĩ", "õ", "ũ", "ᴜ"]

  replacements:
    # eSpeak (classic) en-us has a dictionary entry for "Microsoft" that produces
    # an "-soft" syllable with /ɑː/ ("microsaft"). "soft" by itself is /sɔft/.
    # Normalize the compound to use the same vowel as "soft".
    - from: "sˌɑːft"
      to:   "sˌɔft"
    - from: "sˌɑft"
      to:   "sˌɔft"

    # Acronyms like "NVDA" / "GPDA" end in ...diːˈeɪ. If we rewrite eɪ -> ej,
    # the final letter "A" can sound like "dee-yay". Keep that final A as a
    # long monophthong instead.
    - from: "iːˈeɪ"
      to:   "iːˈeː"
    - from: "iːˈe͡ɪ"
      to:   "iːˈeː"
    - from: "iːˌeɪ"
      to:   "iːˌeː"
    - from: "iːˌe͡ɪ"
      to:   "iːˌeː"

    # Standalone letter name "A": keep it as a long monophthong so it doesn't have
    # an overly strong "ay" glide by itself.
    - from: "ˈeɪ"
      to:   "ˈeː"
      when:
        atWordStart: true
        atWordEnd: true
    - from: "ˈe͡ɪ"
      to:   "ˈeː"
      when:
        atWordStart: true
        atWordEnd: true
    - from: "eɪ"
      to:   "eː"
      when:
        atWordStart: true
        atWordEnd: true
    - from: "e͡ɪ"
      to:   "eː"
      when:
        atWordStart: true
        atWordEnd: true

    # Make FACE (eɪ) sound like a real diphthong instead of a flat "e".
    # Using a semivowel offglide gives a clearer movement in our formant table.
    - from: "eɪ"
      to:   "ej"
    - from: "e͡ɪ"
      to:   "e͡j"

    # Don't add a GOAT offglide for the standalone letter "O" or the word "no".
    # These short tokens can sound like "oww" even with a softened /w/.
    - from: "nˈoʊ"
      to:   "nˈo"
    - from: "nˈo͡ʊ"
      to:   "nˈo"
    - from: "ˈoʊ"
      to:   "ˈo"
    - from: "ˈo͡ʊ"
      to:   "ˈo"


    # Treat GOAT (oʊ) as vowel+glide so it doesn't split into two vowel beats.
    # But in many common words GOAT is an unstressed prefix followed by a consonant
    # that starts the stressed syllable (e.g. "okay" = oʊkˈeɪ). Converting oʊ -> ow
    # makes the /w/ too prominent ("oww-kay"). Collapse those patterns first.
    - from: "oʊkˈ"
      to:   "okˈ"
    - from: "oʊbˈ"
      to:   "obˈ"
    - from: "oʊdˈ"
      to:   "odˈ"
    - from: "oʊfˈ"
      to:   "ofˈ"
    - from: "oʊpˈ"
      to:   "opˈ"
    - from: "oʊtˈ"
      to:   "otˈ"
    - from: "oʊsˈ"
      to:   "osˈ"
    - from: "oʊmˈ"
      to:   "omˈ"
    - from: "oʊlˈ"
      to:   "olˈ"

    # Keep TRAP normalization consistent with the old Python behavior.
    - from: "a"
      to:   "æ"

    # "vowel", "towel" (and similar -owel words):
    # In US screen-reader speech it often sounds clearer to render the final "-el" nucleus
    # more like "-ol" (Eloquence-ish), rather than a distinct schwa+L.
    # Keep this US-only; en-gb keeps the darker /əl/ ending.
    - from: "æʊəl"
      to:   "æʊol"
      when:
        atWordEnd: true
    - from: "æʊəɫ"
      to:   "æʊol"
      when:
        atWordEnd: true

    # eSpeak emits ɐ for a lot of reduced vowels (e.g. "apply" starts with ɐ-).
    # In US speech this can sound a bit "boxy" in our formant table.
    - from: "ɐ"
      to:   "ə"

    # US GOOSE vowel: keep it a touch more forward/bright so words like "pool" and "two" don't drift UK-ish.
    # (en-gb keeps its own quality; this only affects en-us via the ᵿ key.)
    - from: "ᵾ"
      to:   "ᵿ"

    # US GOAT (oʊ) can sound oddly "midwestern" if the /o/ start is too back.
    # Use a slightly more fronted internal variant for en-us.
    - from: "o"
      to:   "ᵒ"

    # US THOUGHT vowel: make /ɔ(ː)/ more open so it doesn't drift toward an "owe" quality.
    - from: "ɔː"
      to:   "ᴐː"
    - from: "ɔ"
      to:   "ᴐ"


    # US English: /-yond/ words are closer to LOT than THOUGHT (Eloquence-ish)
    - from: "jˈᴐnd"
      to:   "jˈᴒnd"
    - from: "jˌᴐnd"
      to:   "jˌᴒnd"
    # BIG ONE:
    # eSpeak’s IPA often uses ɜ(ː) for NURSE even in en-us.
    # Force rhotic NURSE.
    - from: "ɜː"
      to:   "ɝː"
    - from: "ɜ"
      to:   "ɝ"    # In many common words ending in -art (start/smart/cart/apart/depart...),
    # /ɑːɹt/ can sound overly open as a separate "ah" + "r" segment in a formant synth.
    # Nudge it toward a more central "uh" before word-final /t/.
    - from: "ɑːɹt"
      to:   "ʌɹt"
      when:
        atWordEnd: true
    - from: "ɑɹt"
      to:   "ʌɹt"
      when:
        atWordEnd: true



    # Use a dedicated US /r/ variant.

    # NEAR / "ear" words in en-us (fear/hear/dear/ear):
    # Base en.yaml may brighten word-final /ɪɹ/ toward /iɹ/, which can make these sound too strong.
    # Undo that brightening only at word end, so fear/hear stay softer (ɪɹ), then r→ɻ below applies.
    - from: "iɹ"
      to:   "ɪɹ"
      when:
        atWordEnd: true
    # Safety: if /r/ is already mapped to ɻ earlier in the chain, still undo at word end.
    - from: "iɻ"
      to:   "ɪɻ"
      when:
        atWordEnd: true


    # Word-final /ɔɹ/ and /oɹ/ (four, pour, more, door, etc.):
    # In a formant synth the vowel can get pulled into /r/ too quickly, making it feel clipped.
    # Add a very short schwa-like tail (ᵊ) before /r/ only at word end to keep the "oh" audible.
    - from: "ᴐːɹ"
      to:   "ᴐːᵊɹ"
      when:
        atWordEnd: true
    - from: "ᴐɹ"
      to:   "ᴐᵊɹ"
      when:
        atWordEnd: true
    - from: "ᵒːɹ"
      to:   "ᵒːᵊɹ"
      when:
        atWordEnd: true
    - from: "ᵒɹ"
      to:   "ᵒᵊɹ"
      when:
        atWordEnd: true


    - from: "ɹ"
      to:   "ɻ"

    # Word-final R: lengthen it so it doesn't sound clipped or "waiting for next word"
    - from: "ɻ"
      to:   "ɻː"
      when:
        atWordEnd: true

    # Undo the UK THOUGHT tweak from en.yaml (en.yaml maps ɔː -> ᴏː).
    - from: "ᴏ"
      to:   "ɔ"

    # NOTE:
    # We intentionally *do not* undo the base English fronting of long /uː/.
    # eSpeak's en-us still outputs uː in many common words (rules, do, you),
    # and the backer multilingual "u" vowel can make them sound like "roo".

phonemes:
  "ᵿ":
    _isLiquid: false
    _isNasal: false
    _isStop: false
    _isVoiced: true
    _isVowel: true
    aspirationAmplitude: 0
    caNP: 0
    cb1: 71.5
    cb2: 82.5
    cb3: 105
    cb4: 250
    cb5: 200
    cb6: 1000
    cbN0: 100
    cbNP: 100
    cf1: 290
    # GOOSE (uː): we want this to stay a clear "oo" (Eloquence-ish),
    # not drift into a Mid-Atlantic / Scottish-sounding "ʉ"/"ü" quality.
    # Keep F2 only moderately fronted.
    cf2: 1250
    cf3: 2280
    cf4: 3300
    cf5: 3750
    cf6: 4900
    cfN0: 250
    cfNP: 200
    fricationAmplitude: 0
    pa1: 0
    pa2: 0
    pa3: 0
    pa4: 0
    pa5: 0
    pa6: 0
    parallelBypass: 0
    pb1: 65
    pb2: 110
    pb3: 140
    pb4: 250
    pb5: 200
    pb6: 1000
    pf1: 350
    pf2: 1200
    pf3: 2200
    pf4: 3300
    pf5: 3750
    pf6: 4900
    voiceAmplitude: 0.9