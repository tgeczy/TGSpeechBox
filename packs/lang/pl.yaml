# Polish (pl)
# TGSpeechBox language pack.
# Polish is syllable-timed with penultimate stress, no phonemic vowel length,
# heavy consonant clusters, and rich palatalization contrasts.

settings:
  primaryStressDiv: 1.25
  secondaryStressDiv: 1.07

  # Trill modulation (rolled R). Applied only when the phoneme has _isTrill: true.
  trillModulationMs: 50
  trillModulationFadeMs: 2

  # Coarticulation (helps clusters stay intelligible)
  coarticulationEnabled: true
  coarticulationFadeIntoConsonants: true
  coarticulationVelarPinchEnabled: true

  # Safe additions for screen reader use
  singleWordTuningEnabled: true
  singleWordFinalHoldMs: 45
  singleWordFinalFadeMs: 18
  boundarySmoothingEnabled: true

  # --- Phrase-final lengthening ---
  # Polish declarative sentences have a falling nuclear contour (H* L-L%).
  # Nucleus-only mode avoids stretching heavy coda clusters like /stk/ or /ɲtɕ/.
  phraseFinalLengtheningEnabled: true
  phraseFinalLengtheningNucleusOnlyMode: true
  phraseFinalLengtheningFinalSyllableScale: 1.15
  phraseFinalLengtheningPenultimateSyllableScale: 1.05
  phraseFinalLengtheningStatementScale: 1.0
  # Polish yes/no questions rise steeply (+142 Hz female, +81 Hz male per research).
  # Slight shortening cues the listener that more contour is coming.
  phraseFinalLengtheningQuestionScale: 0.88

  # --- Microprosody ---
  # Polish has NO phonemic vowel length. Pre-voiceless shortening is disabled
  # because there's no "bat vs bad" distinction to cue. All vowels are short
  # and equal — stretching or shortening by voicing context sounds foreign.
  microprosodyEnabled: true
  microprosodyVoicelessF0RaiseEnabled: false
  microprosodyVoicedF0LowerEnabled: true
  microprosodyVoicedF0LowerHz: 4.0
  microprosodyVoicedFricativeLowerScale: 0.5
  microprosodyFollowingF0Enabled: true
  microprosodyFollowingVoicelessRaiseHz: 3.0
  microprosodyFollowingVoicedLowerHz: 2.0
  microprosodyIntrinsicF0Enabled: true
  microprosodyIntrinsicF0HighThreshold: 400.0
  microprosodyIntrinsicF0LowThreshold: 600.0
  microprosodyIntrinsicF0HighRaiseHz: 3.0
  microprosodyIntrinsicF0LowDropHz: 2.0
  microprosodyPreVoicelessShortenEnabled: false
  microprosodyMaxTotalDeltaHz: 8.0

  # --- Trajectory limit ---
  # Polish consonant clusters can be massive (5+ consonants word-initially).
  # Trajectory limiting helps formant transitions stay smooth through clusters
  # without smearing identity. Values match Hungarian (also cluster-heavy).
  trajectoryLimitEnabled: true
  trajectoryLimit:
    maxHzPerMs:
      cf2: 24
      cf3: 22
      pf2: 18
      pf3: 22

  # --- Rate compensation ---
  # Heavy clusters need protection at fast speeds. Polish clusters like
  # /pʂ/, /stʂ/, /ʑdʑ/ need each segment to maintain minimum identity.
  rateCompensation:
    enabled: true
    minimumDurations:
      vowelMs: 30
      fricativeMs: 18
      stopMs: 4
      nasalMs: 18
      liquidMs: 15
      affricateMs: 12
      semivowelMs: 10
      tapMs: 4
      trillMs: 12
      voicedConsonantMs: 10
    wordFinalBonusMs: 3
    floorSpeedScale: 0.0
    clusterProportionGuard: true
    clusterMaxRatioShift: 0.4

normalization:
  preReplacements:
    # Map IPA palatalization marker ʲ to internal key (U+E001) to avoid engine bug.
    - from: "ʲ"
      to: ""

    # Make sure common Polish affricate spellings are treated as single tokens.
    - from: "tɕ"
      to: "t͡ɕ"
    - from: "dʑ"
      to: "d͡ʑ"
    - from: "tʂ"
      to: "t͡ʂ"
    - from: "dʐ"
      to: "d͡ʐ"
    - from: "tʃ"
      to: "t͡ʃ"
    - from: "dʒ"
      to: "d͡ʒ"

  replacements:
    # eSpeak Polish uses the palatalization marker ʲ on consonants.
    # With the greedy tokenizer we keep ʲ as its own token (phonemes.yaml defines a subtle ʲ offglide).

    # Some eSpeak outputs use plain 'y' for /ɨ/.
    - from: "y"
      to: "ɨ"

    # If an approximant R sneaks in (from other IPA sources), force it to the trill key.
    - from: "ɹ"
      to: "r"


    # Polish /ɨ/ ("y") is tuned in phonemes.yaml; keep it as ɨ.

    # eSpeak Polish reduces many unstressed /a/ to ɐ, but Polish doesn't really
    # do vowel reduction like that. Keep it as a clearer /a/.
    - from: "ɐ"
      to: "a"

    # eSpeak pl sometimes emits nasal vowels (especially word-final ą as ɔ̃).
    # NVSP doesn't have dedicated ɔ̃/ɛ̃ keys in the base phoneme table, so
    # approximate them as vowel+nasal (matches many other Polish contexts like
    # "kąt" -> ɔnt).
    - from: "ɔ̃"
      to: "ɔn"
    - from: "ɛ̃"
      to: "ɛn"

    # Safety: some IPA sources use velarized-l symbols for Polish "ł".
    # eSpeak usually already outputs /w/, but keep a fallback.
    - from: "ɫ"
      to: "w"
    - from: "l̴"
      to: "w"

    # H / CH – Polish velar fricative (fallback).
    - from: "h"
      to: "x"
    - from: "ɦ"
      to: "x"

    # eSpeak writes Polish cz/dż as tʃ/dʒ (which default.yaml turns into t͡ʃ/d͡ʒ).
    # Polish cz/dż are typically retroflex t͡ʂ/d͡ʐ.
    - from: "t͡ʃ"
      to: "t͡ʂ"
    - from: "d͡ʒ"
      to: "d͡ʐ"

    # eSpeak approximates Polish retroflex sibilants using ʃ/ʒ.
    # Map them to Polish-style ʂ/ʐ to better match the language.
    - from: "ʃ"
      to: "ʂ"
    - from: "ʒ"
      to: "ʐ"