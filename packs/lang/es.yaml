# Spanish.

settings:
  primaryStressDiv: 1.25
  secondaryStressDiv: 1.07

  # Stop closure - use "always" for Spanish to ensure clear consonants
  # and prevent final taps from being swallowed (e.g. "abrir paréntesis").
  # Increased gaps for better consonant separation.
  stopClosureMode: always
  stopClosureVowelGapMs: 30
  stopClosureVowelFadeMs: 6
  stopClosureClusterGapMs: 30
  stopClosureClusterFadeMs: 5
  stopClosureWordBoundaryClusterGapMs: 36
  stopClosureWordBoundaryClusterFadeMs: 5
  
  segmentBoundaryGapMs: 20
  segmentBoundaryFadeMs: 6

  # Boundary smoothing disabled - we want crisp consonants
  boundarySmoothing:
    enabled: false

  # Trill modulation (rolled R). Applied only when the phoneme has _isTrill: true.
  trillModulationMs: 52
  trillModulationFadeMs: 2

  # Single-word utterance smoothing (key echo / word-by-word navigation)
  singleWordTuningEnabled: true
  singleWordFinalHoldMs: 45
  singleWordFinalFadeMs: 18
  singleWordClauseTypeOverride: "."
  singleWordClauseTypeOverrideCommaOnly: true

# Spanish pure vowels - monophthongs without English-style diphthongization.
# These override the base phonemes.yaml values for Spanish.
  spellingDiphthongMode: none
  stopClosureAfterNasalsEnabled: false
  segmentBoundarySkipVowelToLiquid: false
  postStopAspirationEnabled: false
  coarticulationEnabled: false
  coarticulationFadeIntoConsonants: false
  coarticulationVelarPinchEnabled: false
  coarticulationGraduated: false
  coarticulationAdjacencyMaxConsonants: 2
  phraseFinalLengtheningEnabled: false
  phraseFinalLengtheningNucleusOnlyMode: false
  microprosodyEnabled: false
  microprosodyVoicelessF0RaiseEnabled: false
  microprosodyVoicedF0LowerEnabled: false
  rateReductionEnabled: false
  nasalizationAnticipatoryEnabled: false
  liquidDynamics:
    enabled: false
  lengthContrast:
    enabled: false
  allophoneRules:
    enabled: false
    glottalReinforcement:
      enabled: false
  trajectoryLimit:
    enabled: false
    applyAcrossWordBoundary: false
  legacyPitchMode: espeak_style

normalization:
  classes:
    # Let's define vowels for further pronounciation exceptions.
    VOWELS:
      - a
      - e
      - i
      - o
      - u
    # We need to define stressed vowels to fix minor espeak pronounciation mistakes in Spanish.
    STRESSED:
      - "ˈa"
      - "ˈe"
      - "ˈi"
      - "ˈo"
      - "ˈu"

    # This is needed to smoot wors like 'convencer', which are phonetically transcribed into /m/ and /b/ coda.
    SMOOTB:
      - m
  replacements:
    # Custom phoneme tune replacements.
    # Make vowels more central:
    - from: a
      to: a_es
    # Regular e:
    - from: e
      to: e_es
    # Openned e. It is already tuned in phonemes.yaml.
    # Todo: a way to consider a kind of sorted replacements. We replace e to e_es, but now ɛ to e.
    - from: "ɛ"
      to: e
    - from: o
      to: o_es
    - from: u
      to: u_es
    # A slightly softened and less noisy /d/.
    - from: d
      to: d_es
    # A softed g approximant. It is neutral, dialect independent, but this may change in the future.
    - from: "ɣ"
      to: ɣ_es
    # More clear diphthong transition for /j/.
    - from: j
      to: j_es
    # In Spanish, ɪ is a semivowel, part of the glides.
    - from: "ɪ"
      to: "ɪ_es"
    # Yeísmo (neutral):
    - from: "ʎ"
      to: "ʎ_es"
    # Proper sound for l:
    - from: l
      to: l_es
    # More reflection of nasals:
    - from: m
      to: m_es
    - from: n
      to: n_es
    # Castilian sound for /x/.
    - from: x
      to: x_es
    # A temporal workaround to get a /s/ sound with more brightness:
    - from: s
      to: s_es
    # Make ch more clear:
    - from: "t͡ʃ"
      to: "t͡ʃ_es"
    # Pronounciation-level normalization rules:
    # Palatal nasal: some tables emit ñ as nʲ (or n͡ʲ). Map it to /ɲ/ so it doesn't collapse to plain /n/.
    - from: "n͡ʲ"
      to: "ɲ"
    - from: "nʲ"
      to: "ɲ"
    - from: "ɲʲ"
      to: "ɲ"

    # eSpeak Spanish often emits "ʝ" for initial <y>/<ll> (e.g. "yo").
    # We have a dedicated ʝ phoneme; keep it.
    # If a voice uses the affricate ɟʝ, collapse it to ʝ to avoid an overly "hard" onset.
    - from: "ɟʝ"
      to: "ʝ"
    # Smoot /b/ to /β/ in the following cases: before m, and when it is located at the end, example: "velocidad", to avoid strange glitches.
    - from: "b"
      to: "β"
      when:
        beforeClass: SMOOTB
        atWordEnd: true
    # Separate β, ð+ɾ or other clusters (like "habrá" or "madre") so they don't blend together.
    # Insert a micro-schwa to give each consonant space.
    - from: "βɾ"
      to: "βᵊɾ"
    - from: "ðɾ"
      to: "ðᵊɾ"
    - from: "ɡɾ"
      to: "ɡᵊɾ"
    - from: "ɣɾ"
      to: "ɣᵊɾ"
    - from: "kɾ"
      to: "kᵊɾ"
    - from: "pɾ"
      to: "pᵊɾ"
    # Mark the proper "r" also in vowels, for example "para".
    - from: "ɾ"
      to: "ᵊɾ"
      when:
        afterClass: VOWELS
    - from: "tɾ"
      to: "tᵊɾ"
    # Set our own r trill r. The default one lacks naturalness.
    - from: "r"
      to: "ɾᵊɾ"
    # Fix espeak's pronounciation mistakes like 'prueba', when 'u' is preceded by a vowel. That always should be 'w'
    - from: "u"
      to: "w"
      when:
        beforeClass: STRESSED
    # G approximant. To improve clarity, let's convert into non-aproximant g at the start, example: muy grande.
    - from: "ɣ"
      to: "ɡ"
      when:
        atWordStart: true
